<html>
<head>

    <title>FireWatch</title>

    <link rel="icon" type="image/x-icon" href="icon.ico">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; }
        #map { height: 100%; }
    </style>
   
</head>
<body>

<div id="map">
    <script>

        // set the beginning location for the map
        var map = L.map('map').setView([38, -98], 4);   // [latitude, longitude], zoomFactor

        // add OpenStreetMap layer
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Fetch wildfire alerts and add polygons to the map
        //      status is set to actual so that test alerts are not included
        //      alerts are fetched where the event is a "Fire Weather Watch" or a "Red Flag Warning"
        fetch('https://api.weather.gov/alerts/active?status=actual&event=Fire%20Weather%20Watch&event=Red%20Flag%20Warning')
            .then(response => response.json())
            .then(data => {
                data.features.forEach(alert => {
                    if (alert.geometry && alert.geometry.type === "Polygon") {
                        // Create an array of [latitude,longitude] pairs that represent the alert perimeter
                        var coords = alert.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);

                        // Set polygon color based on alert type
                        var color = alert.properties.event === "Fire Weather Watch" ? "orange" : "red";

                        // Add the polygon to the map
                        L.polygon(coords, { color: color, fillOpacity: 0.4 }).addTo(map)
                            .bindPopup(`<b>${alert.properties.event}</b>
                                        <br>${alert.properties.areaDesc}
                                        <br>${alert.properties.headline}`);
                    } else {
                        console.warn("No coordinates for: ", alert.headline);
                    }
                });
            })
            .catch(error => console.error("Error fetching wildfire alerts: ", error));
    </script>
</div>

</body>
</html>
